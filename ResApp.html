<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Residual Calculator - By Ricardo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
–bg: #0a0e1a;
–card: rgba(255, 255, 255, 0.05);
–text: #e6ebff;
–muted: #8b92b0;
–border: rgba(255, 255, 255, 0.1);
–accent: #3b82f6;
–accent-dark: #2563eb;
–success: #10b981;
–danger: #ef4444;
–shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
}

[data-theme=“light”] {
–bg: #f8fafc;
–card: #ffffff;
–text: #0f172a;
–muted: #64748b;
–border: #e2e8f0;
–shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

body {
font-family: ‘Inter’, sans-serif;
background: var(–bg);
color: var(–text);
line-height: 1.6;
min-height: 100vh;
background-image: linear-gradient(135deg, var(–bg) 0%, #1a1f35 100%);
}

.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}

.header {
background: var(–card);
border: 1px solid var(–border);
border-radius: 16px;
padding: 20px;
margin-bottom: 24px;
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
gap: 16px;
box-shadow: var(–shadow);
backdrop-filter: blur(10px);
}

.logo {
background: linear-gradient(135deg, var(–accent), var(–accent-dark));
color: white;
padding: 12px 24px;
border-radius: 50px;
font-weight: 700;
font-size: 0.95rem;
box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
}

.theme-toggle {
background: var(–card);
border: 1px solid var(–border);
color: var(–text);
padding: 10px 20px;
border-radius: 50px;
cursor: pointer;
font-weight: 600;
font-family: ‘Inter’, sans-serif;
transition: all 0.3s;
}

.theme-toggle:hover {
border-color: var(–accent);
transform: translateY(-2px);
}

.card {
background: var(–card);
border: 1px solid var(–border);
border-radius: 16px;
padding: 24px;
margin-bottom: 20px;
box-shadow: var(–shadow);
backdrop-filter: blur(10px);
}

.grid {
display: grid;
gap: 16px;
margin-bottom: 16px;
}

.grid-3 {
grid-template-columns: repeat(3, 1fr);
}

.grid-2 {
grid-template-columns: repeat(2, 1fr);
}

@media (max-width: 768px) {
.grid-3, .grid-2 {
grid-template-columns: 1fr;
}
}

.form-group {
display: flex;
flex-direction: column;
}

label {
font-size: 0.875rem;
font-weight: 600;
color: var(–muted);
margin-bottom: 8px;
text-transform: uppercase;
letter-spacing: 0.5px;
}

select, input {
width: 100%;
padding: 12px 16px;
background: var(–bg);
border: 1px solid var(–border);
border-radius: 12px;
color: var(–text);
font-family: ‘Inter’, sans-serif;
font-size: 0.95rem;
transition: all 0.3s;
}

select:focus, input:focus {
outline: none;
border-color: var(–accent);
box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

select:hover, input:hover {
border-color: var(–accent);
}

.result-box {
background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), transparent);
border: 1px solid var(–border);
border-radius: 12px;
padding: 24px;
margin-bottom: 24px;
display: flex;
align-items: baseline;
gap: 16px;
flex-wrap: wrap;
}

.result-value {
font-size: 3rem;
font-weight: 900;
background: linear-gradient(135deg, var(–accent), var(–accent-dark));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.result-text {
font-size: 1rem;
color: var(–muted);
}

.table-wrap {
overflow-x: auto;
border: 1px solid var(–border);
border-radius: 12px;
margin-top: 20px;
}

table {
width: 100%;
min-width: 700px;
border-collapse: collapse;
}

th, td {
padding: 14px 16px;
text-align: left;
border-bottom: 1px solid var(–border);
}

th {
font-size: 0.8rem;
font-weight: 700;
color: var(–muted);
text-transform: uppercase;
letter-spacing: 0.5px;
background: var(–card);
}

tbody tr:hover {
background: rgba(255, 255, 255, 0.02);
}

.ok {
color: var(–success);
font-weight: 700;
}

.err {
color: var(–danger);
opacity: 0.5;
}

.summary {
background: var(–card);
border: 1px solid var(–border);
border-radius: 16px;
padding: 24px;
margin-top: 24px;
}

.summary-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 12px;
margin-top: 16px;
}

@media (max-width: 768px) {
.summary-grid {
grid-template-columns: 1fr;
}
}

.summary-row {
display: flex;
justify-content: space-between;
align-items: center;
background: rgba(255, 255, 255, 0.03);
border: 1px solid var(–border);
padding: 14px 16px;
border-radius: 12px;
}

.summary-label {
font-weight: 600;
color: var(–muted);
font-size: 0.9rem;
}

.summary-value {
font-weight: 700;
font-size: 1rem;
}

.badges {
display: flex;
gap: 10px;
flex-wrap: wrap;
margin-top: 16px;
}

.badge {
background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));
border: 1px solid var(–border);
padding: 8px 16px;
border-radius: 50px;
font-size: 0.85rem;
font-weight: 600;
}

.copy-btn {
background: var(–accent);
color: white;
border: none;
padding: 10px 20px;
border-radius: 50px;
cursor: pointer;
font-weight: 600;
font-family: ‘Inter’, sans-serif;
transition: all 0.3s;
}

.copy-btn:hover {
background: var(–accent-dark);
transform: translateY(-2px);
}

.flex-between {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 16px;
}

.checkbox-group {
display: flex;
gap: 16px;
align-items: center;
flex-wrap: wrap;
}

.checkbox-label {
display: flex;
gap: 8px;
align-items: center;
cursor: pointer;
}

input[type=“checkbox”] {
width: 20px;
height: 20px;
cursor: pointer;
accent-color: var(–accent);
}

.hint {
font-size: 0.8rem;
color: var(–muted);
margin-top: 6px;
}

.footer {
background: var(–card);
border: 1px solid var(–border);
border-radius: 16px;
padding: 20px;
margin-top: 32px;
box-shadow: var(–shadow);
}

.footer-title {
font-weight: 800;
margin-bottom: 8px;
font-size: 1.1rem;
}

.footer-text {
color: var(–muted);
font-size: 0.92rem;
line-height: 1.6;
}
</style>

</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">Residual Calculator - By Ricardo</div>
    <button id="themeBtn" class="theme-toggle">Toggle Theme</button>
  </div>

  <div class="card">
    <div class="grid grid-3">
      <div class="form-group">
        <label>Model Family</label>
        <select id="familySel"></select>
      </div>
      <div class="form-group">
        <label>Model Year</label>
        <select id="yearSel"></select>
      </div>
      <div class="form-group">
        <label>Trim</label>
        <select id="trimSel"></select>
        <div class="hint" id="trimCount"></div>
      </div>
    </div>

```
<div class="grid grid-3">
  <div class="form-group">
    <label>Search Trim</label>
    <input id="trimSearch" type="text" placeholder="Filter by name or code">
  </div>
  <div class="form-group">
    <label>Term (months)</label>
    <select id="termSel"></select>
  </div>
  <div class="checkbox-group" style="margin-top: 28px;">
    <label class="checkbox-label">
      <input id="pacpoToggle" type="checkbox">
      <span>+2% PACPO</span>
    </label>
    <label class="checkbox-label">
      <input id="hideNA" type="checkbox">
      <span>Hide N/A</span>
    </label>
  </div>
</div>

<div class="grid grid-2">
  <div class="form-group">
    <label>Miles at Inception</label>
    <input id="odoInput" type="number" min="0" placeholder="e.g., 3450">
  </div>
  <div class="form-group">
    <label>Miles per Year</label>
    <select id="annualMilesSel"></select>
  </div>
</div>
```

  </div>

  <div class="card">
    <div class="result-box">
      <div class="result-value" id="finalOut">-</div>
      <div class="result-text" id="detailOut">Select options to calculate</div>
    </div>

```
<div class="table-wrap">
  <table>
    <thead><tr id="theadRow"></tr></thead>
    <tbody><tr id="tvalRow"></tr></tbody>
  </table>
</div>

<div class="summary">
  <div class="flex-between">
    <strong>Summary</strong>
    <button id="copyBtn" class="copy-btn">Copy</button>
  </div>

  <div class="summary-grid">
    <div class="summary-row">
      <span class="summary-label">Model Year</span>
      <span class="summary-value" id="sumYear">-</span>
    </div>
    <div class="summary-row">
      <span class="summary-label">Family</span>
      <span class="summary-value" id="sumFamily">-</span>
    </div>
    <div class="summary-row">
      <span class="summary-label">Trim</span>
      <span class="summary-value" id="sumTrim">-</span>
    </div>
    <div class="summary-row">
      <span class="summary-label">Term</span>
      <span class="summary-value" id="sumTerm">-</span>
    </div>
    <div class="summary-row">
      <span class="summary-label">Miles/Year</span>
      <span class="summary-value" id="sumMilesYear">-</span>
    </div>
    <div class="summary-row">
      <span class="summary-label">Odometer</span>
      <span class="summary-value" id="sumOdo">-</span>
    </div>
  </div>

  <div class="badges" id="badgeRow"></div>

  <div class="summary-row" style="margin-top: 16px; border: 2px solid var(--accent);">
    <span class="summary-label" style="color: var(--accent);">Final Residual</span>
    <span class="summary-value" id="sumFinal" style="font-size: 1.3rem; color: var(--accent);">-</span>
  </div>
</div>
```

  </div>

  <div class="footer">
    <div class="footer-title">Made by Ricardo</div>
    <div class="footer-text">
      This tool is proprietary. Redistribution, copying, or use without explicit written consent is prohibited.
      <strong>Ask first. Respect the craft.</strong>
    </div>
  </div>
</div>

<script>
(function() {
  var themeBtn = document.getElementById('themeBtn');
  var familySel = document.getElementById('familySel');
  var yearSel = document.getElementById('yearSel');
  var trimSel = document.getElementById('trimSel');
  var trimSearch = document.getElementById('trimSearch');
  var trimCount = document.getElementById('trimCount');
  var termSel = document.getElementById('termSel');
  var pacpoToggle = document.getElementById('pacpoToggle');
  var hideNA = document.getElementById('hideNA');
  var finalOut = document.getElementById('finalOut');
  var detailOut = document.getElementById('detailOut');
  var theadRow = document.getElementById('theadRow');
  var tvalRow = document.getElementById('tvalRow');
  var annualMilesSel = document.getElementById('annualMilesSel');
  var odoInput = document.getElementById('odoInput');
  var sumYear = document.getElementById('sumYear');
  var sumFamily = document.getElementById('sumFamily');
  var sumTrim = document.getElementById('sumTrim');
  var sumTerm = document.getElementById('sumTerm');
  var sumMilesYear = document.getElementById('sumMilesYear');
  var sumOdo = document.getElementById('sumOdo');
  var sumFinal = document.getElementById('sumFinal');
  var badgeRow = document.getElementById('badgeRow');
  var copyBtn = document.getElementById('copyBtn');

  var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');

  themeBtn.addEventListener('click', function() {
    var current = document.documentElement.getAttribute('data-theme');
    var next = current === 'light' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', next);
  });

  var data;
  var MONTHS;
  var PACPO;
  var fullTrimList = [];

  fetch('porsche_residuals_all.json?v=' + Date.now())
    .then(function(res) { return res.json(); })
    .then(function(json) {
      data = json;
      MONTHS = data.months || ["12","18","24","27","30","36","39","42","48","51","60"];
      PACPO = data.pacpo_bonus_percent || 2;
      init();
    })
    .catch(function(err) {
      alert('Failed to load JSON: ' + err.message);
    });

  function normalizeYearKey(k) {
    var s = String(k).trim();
    var mPlain = s.match(/^(20\d{2})$/);
    if (mPlain) return { display: 'MY' + mPlain[1].slice(-2), key: k };
    var mMY = s.toUpperCase().replace(/\s+/g,'').match(/^MY(\d{2})$/);
    if (mMY) return { display: 'MY' + mMY[1], key: k };
    return { display: s, key: k };
  }

  function getCaseInsensitive(obj, name) {
    if (!obj || typeof obj !== "object") return undefined;
    var target = String(name).replace(/\s+/g,'').toLowerCase();
    var keys = Object.keys(obj);
    for (var i = 0; i < keys.length; i++) {
      var norm = keys[i].replace(/\s+/g,'').toLowerCase();
      if (norm === target) return obj[keys[i]];
    }
    return undefined;
  }

  function getVirtualFamilies() {
    var out = new Set();
    var models = data.models || {};
    var keys = Object.keys(models);
    for (var i = 0; i < keys.length; i++) {
      var f = keys[i];
      if (f === '718') {
        var cay = getCaseInsensitive(models['718'], 'Cayman');
        var box = getCaseInsensitive(models['718'], 'Boxster');
        if (cay) out.add('718 Cayman');
        if (box) out.add('718 Boxster');
      } else {
        out.add(f);
      }
    }
    if (models['Cayman']) out.add('718 Cayman');
    if (models['Boxster']) out.add('718 Boxster');
    var order = ['911','718 Cayman','718 Boxster','Taycan','Macan','Cayenne','Panamera'];
    return Array.from(out).sort(function(a, b) {
      return order.indexOf(a) - order.indexOf(b);
    });
  }

  function branchForFamily(famDisp) {
    var models = data.models || {};
    if (famDisp === '718 Cayman') {
      return getCaseInsensitive(models['718'] || {}, 'Cayman') || models['Cayman'] || {};
    }
    if (famDisp === '718 Boxster') {
      return getCaseInsensitive(models['718'] || {}, 'Boxster') || models['Boxster'] || {};
    }
    return models[famDisp] || {};
  }

  function yearsForFamily(famDisp) {
    var out = new Set();
    var branch = branchForFamily(famDisp);
    var keys = Object.keys(branch);
    for (var i = 0; i < keys.length; i++) {
      out.add(normalizeYearKey(keys[i]).display);
    }
    return Array.from(out).sort(function(a, b) {
      var ay = parseInt(a.replace(/\D/g,''), 10);
      var by = parseInt(b.replace(/\D/g,''), 10);
      if (isNaN(ay) || isNaN(by)) return b.localeCompare(a);
      return by - ay;
    });
  }

  function populateFamilies() {
    familySel.innerHTML = '';
    var families = getVirtualFamilies();
    for (var i = 0; i < families.length; i++) {
      var opt = document.createElement('option');
      opt.value = families[i];
      opt.textContent = families[i];
      familySel.appendChild(opt);
    }
  }

  function populateYears() {
    yearSel.innerHTML = '';
    var years = yearsForFamily(familySel.value);
    for (var i = 0; i < years.length; i++) {
      var opt = document.createElement('option');
      opt.value = years[i];
      opt.textContent = years[i];
      yearSel.appendChild(opt);
    }
  }

  function collectTrimsForYear() {
    fullTrimList = [];
    var branch = branchForFamily(familySel.value);
    var dispYear = yearSel.value;
    var keys = Object.keys(branch);
    var yearKeys = [];
    for (var i = 0; i < keys.length; i++) {
      if (normalizeYearKey(keys[i]).display === dispYear) {
        yearKeys.push(keys[i]);
      }
    }
    var yearKey = yearKeys[0];
    var rows = (yearKey && branch[yearKey]) || {};
    var entries = Object.entries(rows);
    for (var i = 0; i < entries.length; i++) {
      fullTrimList.push({
        code: entries[i][0],
        model: entries[i][1].model || entries[i][0]
      });
    }
  }

  function populateTrims(filterTerm) {
    if (filterTerm === undefined) filterTerm = "";
    trimSel.innerHTML = '';
    var term = filterTerm.trim().toLowerCase();
    var filtered = [];
    for (var i = 0; i < fullTrimList.length; i++) {
      var hay = (fullTrimList[i].model + " " + fullTrimList[i].code).toLowerCase();
      if (hay.indexOf(term) !== -1) {
        filtered.push(fullTrimList[i]);
      }
    }
    for (var i = 0; i < filtered.length; i++) {
      var opt = document.createElement('option');
      opt.value = filtered[i].code;
      opt.textContent = filtered[i].model;
      trimSel.appendChild(opt);
    }
    trimCount.textContent = filtered.length + ' trim(s) available';
  }

  function populateTerms() {
    termSel.innerHTML = '';
    for (var i = 0; i < MONTHS.length; i++) {
      var opt = document.createElement('option');
      opt.value = MONTHS[i];
      opt.textContent = MONTHS[i] + ' months';
      termSel.appendChild(opt);
    }
  }

  function populateAnnualMiles() {
    annualMilesSel.innerHTML = '';
    var milesMap = (data.annual_mileage_adjustments_percent && data.annual_mileage_adjustments_percent.miles_per_year) || {
      "2500":6,"5000":5,"7500":4,"10000":3,"12000":2,"15000":0
    };
    var keys = Object.keys(milesMap).map(function(k) {
      return parseInt(k, 10);
    }).sort(function(a, b) {
      return a - b;
    });
    for (var i = 0; i < keys.length; i++) {
      var opt = document.createElement('option');
      opt.value = String(keys[i]);
      opt.textContent = keys[i].toLocaleString() + ' mi/yr';
      annualMilesSel.appendChild(opt);
    }
    annualMilesSel.value = "15000";
  }

  function parseRange(str) {
    if (!str) return null;
    var s = str.replace(/,/g,'').replace(/\s/g,'');
    var parts = s.split(/–|-/);
    if (parts.length !== 2) return null;
    var a = parseInt(parts[0], 10);
    var b = parseInt(parts[1], 10);
    if (isNaN(a) || isNaN(b)) return null;
    return [a, b];
  }

  function findInceptionAdj(myKey, odo) {
    var bands = (data.mileage_at_inception_adjustments_percent && data.mileage_at_inception_adjustments_percent[myKey]) || null;
    if (!bands || odo == null) return 0;
    for (var i = 0; i < bands.length; i++) {
      var rng = parseRange(bands[i].miles_range);
      if (!rng) continue;
      if (odo >= rng[0] && odo <= rng[1]) return bands[i].adj || 0;
    }
    return 0;
  }

  function buildHeader(visibleMonths) {
    theadRow.innerHTML = '';
    var th1 = document.createElement('th');
    th1.textContent = 'Trim / Term';
    theadRow.appendChild(th1);
    for (var i = 0; i < visibleMonths.length; i++) {
      var th = document.createElement('th');
      th.textContent = visibleMonths[i] + ' mo';
      theadRow.appendChild(th);
    }
  }

  function visibleMonthsFor(entry) {
    if (!hideNA.checked) return MONTHS.slice();
    var result = [];
    for (var i = 0; i < MONTHS.length; i++) {
      if (entry && entry.residuals && entry.residuals[MONTHS[i]] != null) {
        result.push(MONTHS[i]);
      }
    }
    return result;
  }

  function compute() {
    var fam = familySel.value;
    var branch = branchForFamily(fam);
    var dispYear = yearSel.value;
    var keys = Object.keys(branch);
    var yearKeys = [];
    for (var i = 0; i < keys.length; i++) {
      if (normalizeYearKey(keys[i]).display === dispYear) {
        yearKeys.push(keys[i]);
      }
    }
    var yrKey = yearKeys[0];
    var code = trimSel.value;
    var term = termSel.value;
    var milesPerYear = parseInt(annualMilesSel.value, 10);
    var odo = odoInput.value ? parseInt(odoInput.value.replace(/,/g,''), 10) : null;

    if (!yrKey || !code) return;

    var entry = branch[yrKey][code];
    var base = term ? ((entry && entry.residuals && entry.residuals[term]) || null) : null;
    var pacpoAdj = pacpoToggle.checked ? PACPO : 0;
    var milesMap = (data.annual_mileage_adjustments_percent && data.annual_mileage_adjustments_percent.miles_per_year) || {};
    var annualAdj = 0;
    if (base !== null && parseInt(term || "0", 10) >= 24) {
      annualAdj = milesMap[String(milesPerYear)] || 0;
    }

    var inceptionKeyCandidates = [yrKey, dispYear, dispYear.replace(/\s+/g,'')];
    var inceptionAdj = 0;
    for (var i = 0; i < inceptionKeyCandidates.length; i++) {
      var bands = (data.mileage_at_inception_adjustments_percent && data.mileage_at_inception_adjustments_percent[inceptionKeyCandidates[i]]) || null;
      if (bands) {
        inceptionAdj = findInceptionAdj(inceptionKeyCandidates[i], odo);
        break;
      }
    }

    var monthsShown = visibleMonthsFor(entry);
    buildHeader(monthsShown);

    var final = (base === null || term == null) ? null : (base + pacpoAdj + annualAdj + inceptionAdj);
    finalOut.textContent = final === null ? '-' : final + '%';
    detailOut.textContent = final === null ? 'Select a term to calculate' : 'Final residual with all adjustments';

    tvalRow.innerHTML = '';
    var lead = document.createElement('td');
    lead.textContent = (entry && entry.model) || '-';
    tvalRow.appendChild(lead);
    for (var i = 0; i < monthsShown.length; i++) {
      var td = document.createElement('td');
      var v = entry && entry.residuals && entry.residuals[monthsShown[i]];
      var shown = '-';
      if (v !== null && v !== undefined) {
        var mN = parseInt(monthsShown[i], 10);
        var aAdj = (mN >= 24) ? (milesMap[String(milesPerYear)] || 0) : 0;
        var total = v + pacpoAdj + aAdj + inceptionAdj;
        shown = total + '%';
        td.classList.add('ok');
      } else {
        td.classList.add('err');
      }
      td.textContent = shown;
      tvalRow.appendChild(td);
    }

    sumYear.textContent = dispYear || '-';
    sumFamily.textContent = fam || '-';
    sumTrim.textContent = (entry && entry.model) || '-';
    sumTerm.textContent = term ? term + ' mo' : '-';
    sumMilesYear.textContent = isFinite(milesPerYear) ? milesPerYear.toLocaleString() + ' mi/yr' : '-';
    sumOdo.textContent = (odo != null && !isNaN(odo)) ? odo.toLocaleString() + ' mi' : '-';

    badgeRow.innerHTML = '';
    if (base !== null && term) {
      var b = document.createElement('div');
      b.className = 'badge';
      b.textContent = 'Base ' + base + '%';
      badgeRow.appendChild(b);
    }
    if (pacpoToggle.checked) {
      var b = document.createElement('div');
      b.className = 'badge';
      b.textContent = '+' + PACPO + '% PACPO';
      badgeRow.appendChild(b);
    }
    if (term && parseInt(term, 10) >= 24) {
      var a = document.createElement('div');
      a.className = 'badge';
      var adj = annualAdj >= 0 ? '+' + annualAdj + '%' : annualAdj + '%';
      a.textContent = adj + ' Annual Miles';
      badgeRow.appendChild(a);
    }
    if (odo != null && !isNaN(odo)) {
      var i = document.createElement('div');
      i.className = 'badge';
      var adj = inceptionAdj >= 0 ? '+' + inceptionAdj + '%' : inceptionAdj + '%';
      i.textContent = adj + ' Inception';
      badgeRow.appendChild(i);
    }

    sumFinal.textContent = final === null ? '-' : final + '%';
  }

  copyBtn.addEventListener('click', function() {
    var text = [
      'Year: ' + sumYear.textContent,
      'Family: ' + sumFamily.textContent,
      'Trim: ' + sumTrim.textContent,
      'Term: ' + sumTerm.textContent,
      'Miles/Year: ' + sumMilesYear.textContent,
      'Odometer: ' + sumOdo.textContent,
      'Final Residual: ' + sumFinal.textContent
    ].join(' | ');
    navigator.clipboard.writeText(text).then(function() {
      var old = copyBtn.textContent;
      copyBtn.textContent = 'Copied!';
      setTimeout(function() {
        copyBtn.textContent = old;
      }, 1200);
    });
  });

  function init() {
    populateFamilies();
    populateYears();
    populateTerms();
    populateAnnualMiles();
    collectTrimsForYear();
    populateTrims();
    compute();
  }

  familySel.addEventListener('change', function() {
    populateYears();
    collectTrimsForYear();
    populateTrims(trimSearch.value);
    compute();
  });

  yearSel.addEventListener('change', function() {
    collectTrimsForYear();
    populateTrims(trimSearch.value);
    compute();
  });

  trimSearch.addEventListener('input', function() {
    populateTrims(trimSearch.value);
    compute();
  });

  trimSel.addEventListener('change', compute);
  termSel.addEventListener('change', compute);
  pacpoToggle.addEventListener('change', compute);
  hideNA.addEventListener('change', compute);
  annualMilesSel.addEventListener('change', compute);
  odoInput.addEventListener('input', compute);
})();
</script>

</body>
</html>
